<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mi Perfil - GitHub Complements</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 0;
      background-color: #f4f6f9;
      color: #333;
    }
    .header {
      background-color: #24292e;
      color: white;
      padding: 20px;
      text-align: center;
    }
    .header h1 {
      margin: 0; font-size: 24px;
    }
    .container {
      max-width: 900px;
      margin: 30px auto;
      padding: 20px;
      background: white;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .profile-details {
      text-align: center;
      margin-bottom: 30px;
    }
    .profile-details img {
      width: 120px; height: 120px;
      border-radius: 50%;
      border: 4px solid #0366d6;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }
    .profile-details h2 {
      margin: 15px 0 5px;
      font-size: 22px;
      color: #24292e;
    }
    .profile-details p {
      margin: 5px 0;
      color: #555;
    }
    .info-box {
      border: 1px solid #ddd;
      padding: 20px;
      margin-top: 20px;
      border-radius: 10px;
      background: #fafafa;
    }
    .info-box h3 {
      color: #0366d6;
      margin-bottom: 15px;
      border-bottom: 1px solid #eee;
      padding-bottom: 8px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    table th, table td {
      text-align: left;
      padding: 10px;
      border-bottom: 1px solid #eee;
    }
    table th {
      background: #f4f6f9;
    }
    .buttons {
      margin-top: 30px;
      display: flex;
      justify-content: center;
      gap: 15px;
    }
    .btn {
      display: inline-block;
      padding: 12px 25px;
      border-radius: 6px;
      text-decoration: none;
      font-weight: bold;
      transition: background 0.3s ease;
    }
    .btn-dashboard {
      background: #0366d6; color: white;
    }
    .btn-dashboard:hover {
      background: #024f9d;
    }
    .btn-logout {
      background: #d9534f; color: white;
    }
    .btn-logout:hover {
      background: #b52b27;
    }
  </style>
</head>
<body>
  <header class="header">
    <h1>Mi Perfil</h1>
  </header>

  <div class="container">
    <div class="profile-details">
      <img src="pf.png" alt="Foto de Perfil">
      <h2 id="client-name">Cargando...</h2>
      <p><strong>Email:</strong> <span id="client-email">Cargando...</span></p>
    </div>

    <div class="info-box">
      <h3>Detalles del Plan</h3>
      <table>
        <tr><th>Plan actual</th><td id="client-plan">Cargando...</td></tr>
        <tr><th>Fecha de inicio</th><td>22/08/2025</td></tr>
        <tr><th>Próximo pago</th><td>21/09/2025</td></tr>
        <tr><th>Precio</th><td>$53.89 / mes</td></tr>
      </table>
    </div>

    <div class="info-box">
      <h3>Historial de Pagos</h3>
      <table>
        <tr>
          <th>Fecha</th>
          <th>Descripción</th>
          <th>Costo</th>
        </tr>
        <tr>
          <td>22/08/2025</td>
          <td>Plan Básico Mensual</td>
          <td>$53.89</td>
        </tr>
      </table>
    </div>

    <div class="buttons">
      <a href="dashboard.html" class="btn btn-dashboard">← Volver al Dashboard</a>
      <a href="#" onclick="logout()" class="btn btn-logout">Cerrar sesión</a>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBHh9wVVYBe9wF4jr9AXk_KIVkrs6EZbh0",
      authDomain: "autpage-d1353.firebaseapp.com",
      projectId: "autpage-d1353",
      storageBucket: "autpage-d1353.firebasestorage.app",
      messagingSenderId: "171366854093",
      appId: "1:171366854093:web:29bba0030790d568b86884",
      measurementId: "G-R0RFQQZ8QS"
    };
    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    window.onload = function () {
      firebase.auth().onAuthStateChanged((user) => {
        if (!user) {
          window.location.href = 'index.html';
        } else {
          db.collection("users").doc(user.uid).get()
            .then((doc) => {
              if (doc.exists) {
                const userData = doc.data();
                console.log("Datos del usuario:", userData);

                document.getElementById('client-name').textContent =
                  userData.client || "Nombre no disponible";
                document.getElementById('client-email').textContent =
                  userData.email || "Correo no disponible";
                document.getElementById('client-plan').textContent =
                  userData.planId || "Plan no asignado";
              } else {
                document.getElementById('client-name').textContent = "Perfil incompleto";
                document.getElementById('client-email').textContent = "No hay datos registrados";
                document.getElementById('client-plan').textContent = "Plan sin asignar";
                console.warn("No se encontró documento en la colección 'users'");
              }
            })
            .catch((error) => {
              console.error("Error al obtener datos:", error);
              document.getElementById('client-name').textContent = "Error al cargar datos";
              document.getElementById('client-email').textContent = "—";
              document.getElementById('client-plan').textContent = "—";
            });
        }
      });
    };

    function logout() {
      firebase.auth().signOut().then(() => {
        window.location.href = 'index.html';
      });
    }
  </script>
</body>
</html>
